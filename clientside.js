// Generated by CoffeeScript 1.4.0
(function() {
  var Channel, helpers, io, lweb, shared, _,
    __slice = [].slice;

  io = require('socket.io-browserify');

  helpers = require('helpers');

  _ = require('underscore');

  _.extend(exports, shared = require('./shared'));

  Channel = exports.Channel = shared.SubscriptionMan.extend4000({
    initialize: function() {
      var _this = this;
      this.name = this.get('name' || (function() {
        throw 'channel needs a name';
      })());
      this.socket = this.get('lweb').socket || (function() {
        throw 'channel needs lweb';
      })();
      this.socket.emit('subscribe', {
        channel: this.name
      });
      return this.socket.on(this.name, function(msg) {
        return _this.event(msg);
      });
    },
    unsubscribe: function() {
      return this.socket.emit('unsubscribe', {
        channel: this.name
      });
    },
    del: function() {
      return this.unsubscribe();
    }
  });

  lweb = exports.lweb = shared.lwebInterface.extend4000({
    connect: function(host) {
      if (host == null) {
        host = "http://" + window.location.host;
      }
      return this.socket = io.connect(host);
    },
    once: function() {
      var args;
      args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
      return this.socket.once.apply(this.socket, args);
    },
    on: function() {
      var args;
      args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
      return this.socket.on.apply(this.socket, args);
    },
    emit: function() {
      var args;
      args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
      return this.socket.once.apply(this.socket, args);
    },
    subscribe: function(channelname) {
      return new Channel({
        lweb: this,
        name: channelname
      });
    }
  });

}).call(this);
